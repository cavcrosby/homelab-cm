---
{#
  Manifest for the Kubernetes cert-manager Issuer objects.
#}
apiVersion: v1
kind: Secret
metadata:
  name: aws-creds
  namespace: {{ namespace_ }}
stringData:
  aws_access_key_id: {{ aws_access_key_id_main_cert_manager }}
  aws_secret_access_key: {{ aws_secret_access_key_main_cert_manager }}

---
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt
  namespace: {{ namespace_ }}
spec:
  acme:
    email: cavcrosby@gmail.com
    profile: shortlived
    disableAccountKeyGeneration: true
    server: {{ letsencrypt_server_url }}
    privateKeySecretRef:
      name: acme-account-privkey
    solvers:
      - dns01:
          route53:
            region: us-east-1
            accessKeyIDSecretRef:
              name: aws-creds
              key: aws_access_key_id
            secretAccessKeySecretRef:
              name: aws-creds
              key: aws_secret_access_key
